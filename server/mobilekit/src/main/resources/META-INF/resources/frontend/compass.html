<!--

    Copyright (C) 2013-2019 by XDEV Software, All Rights Reserved.

    This program and the accompanying materials
    are made available under the terms of the Eclipse Public License 2.0
    which accompanies this distribution, and is available at
    https://www.eclipse.org/legal/epl-2.0/

    SPDX-License-Identifier: EPL-2.0

    Contributors:
        XDEV Software Corp. - initial API and implementation

-->
<link rel="import" href="bower_components/polymer/polymer-element.html">

<dom-module id="mobilekit-compass"> 

<script>
		
	class MobilekitCompass extends Polymer.Element {
		static get is(){
			return 'mobilekit-compass';
		}
		
		getCurrentHeading(id,options){
			var _this = this, _server = this.$server;
			navigator.compass.getCurrentHeading(
				function(heading){
					_server.getCurrentHeading_success(id,_this.cloneAsObject(heading));
				},
				function(error){
					_server.getCurrentHeading_error(id,_this.cloneAsObject(error));	
				},
				options);
		}
				
		watchHeading(id,options){
			var _this = this, _server = this.$server;
			var watchId = navigator.compass.watchHeading(
				function(heading){
					_server.watchHeading_success(id,_this.cloneAsObject(heading),watchId);
				},
				function(error){
					_server.watchHeading_error(id,_this.cloneAsObject(error));	
				},
				options);
		}
				
		clearWatch(watchId){
			navigator.compass.clearWatch(watchId);
		}
		
		cloneAsObject(obj) {
		    if (obj === null || !(obj instanceof Object)) { return obj; }
		    var temp = (obj instanceof Array) ? [] : {};
		    for (var key in obj) { temp[key] = this.cloneAsObject(obj[key]); }
		    return temp;
		}
	}
	customElements.define(MobilekitCompass.is, MobilekitCompass);
	
</script> 

</dom-module>